#!/usr/bin/env bash

# Install Git if missing
if ! command -v git &>/dev/null; then
    if [[ "$(uname)" == "Darwin" ]]; then
        /bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"
        eval "$(/opt/homebrew/bin/brew shellenv)"
        brew install git
    else
        sudo apt -y update && sudo apt -y install git
    fi
fi

# Ensure ~/personal directory exists
PERSONAL_DIR="$HOME/personal"
DEV_DIR="$HOME/dev"

mkdir -p "$PERSONAL_DIR"

# Clone repo if it doesn't already exist
if [ ! -d "$DEV_DIR" ] || [ -z "$(ls -A "$DEV_DIR")" ] || [ ! -d "$DEV_DIR/.git" ]; then
    rm -rf "$DEV_DIR"
    git clone https://github.com/thenameiswiiwin/.dotfiles "$DEV_DIR"
else
    echo "Repo already exists at $DEV_DIR. Skipping clone."
fi

# Run the setup script
pushd "$DEV_DIR" || exit 1
./run
popd
