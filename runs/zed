#!/usr/bin/env bash
set -e
set -o pipefail
set -u

echo "Installing Zed..."

# Detect OS
OS="$(uname -s)"

install_zed() {
    if [[ "$OS" == "Darwin" ]]; then
        echo "Installing Zed via Homebrew..."
        brew install --cask zed
    elif [[ "$OS" == "Linux" ]]; then
        echo "Installing Zed via official script..."
        if ! command -v curl &>/dev/null; then
            echo "Curl is not installed. Installing it now..."
            sudo apt update && sudo apt install -y curl
        fi
        curl -fsSL https://zed.dev/install.sh | sh
    elif [[ "$OS" =~ "MINGW" || "$OS" =~ "CYGWIN" || "$OS" == "Windows_NT" ]]; then
        echo "Windows detected. Installing Zed manually..."
        powershell.exe -Command "& {Start-Process 'https://zed.dev/download' -Wait}"
    else
        echo "Unsupported OS: $OS"
        exit 1
    fi
}

install_zed

echo "Zed installation completed."
